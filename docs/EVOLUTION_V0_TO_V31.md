# OC-Monitor 演进记录（V0 → V3.1）

> 这份文档记录了项目从 0 开始，到 V3.1 基线能力落地的全过程。  
> 重点是“每一步为什么做、改了什么、最终实现了什么”。

---

## V0：范围冻结（从想法到可执行蓝图）

### 背景
初期需求很多：节点监控、日志、告警、权限、通知、部署脚本……如果不先冻结范围，项目会在前期反复返工。

### 核心决策
- 先做 **MVP（V1）**，只保留“监控闭环最小集合”
- 架构固定为：`Server + Agent + Web`
- 数据通道固定：`Agent 心跳 -> Server 入库 -> Web 实时订阅`

### 产物
- `docs/v1-scope.md`（冻结 V1 目标、非目标、数据模型、API 边界）

---

## V1：MVP 可运行（先跑起来）

### 目标
在最短路径内实现：可部署、可看、可验证。

### 主要实现
1. **Server（Node.js + SQLite）**
   - 心跳接收 API
   - 节点与日志查询 API
   - 健康检查接口
2. **Agent（Bash/Python）**
   - 采集 CPU / 内存 / 磁盘等基础指标
   - 携带 token 上报
3. **WebSocket 实时通道**
   - 节点状态变化实时推送到前端
4. **最小部署脚本**
   - 能在目标机器快速起服务
5. **基础压测验证**
   - 验证多节点并发下接口和心跳处理可用

### 阶段结果
- 从“文档设计”进入“可运行系统”
- 可观察节点在线状态与资源快照

---

## V2：体验与权限升级（从能用到好用）

### 目标
提升操作体验与可控性，减少“能看但不好用”的问题。

### 主要实现
- UI 升级为 Mission Control 风格（KPI、卡片、Tab、状态可视化）
- 默认脱敏视图 + 授权后完整视图
- Token 解锁能力
- 管理员登录/登出/会话鉴权
- 亮暗主题切换

### 文档
- `docs/v2-scope.md`

### 阶段结果
- 可读性和操作效率明显提升
- 监控台进入“可长期使用”状态

---

## V2.5：稳态化与可分享交付（P0-P5）

### 目标
让系统不仅能运行，还能审计、留存、治理和对外分享部署。

### P0：UI 收尾
- 清理冗余信息
- 状态胶囊统一
- Toast 反馈优化
- 登录 / Token 弹窗重做

### P1：告警中心
- 告警类型：offline / stale / cpu / mem / disk
- 告警列表与状态展示形成统一入口

### P2：审计能力
- 管理员登录/退出行为记录
- CSV 导出便于追溯

### P3：数据留存策略
- events 保留 30 天
- heartbeats 保留 14 天
- 定时清理任务

### P4：健康总览
- server/ws/nodes/db/provider/retention 一屏可见

### P5：告警操作闭环
- ACK（确认）
- 静默 30 分钟（mute 30m）

### 阶段结果
- 系统从“功能可用”升级为“运维可用”
- 具备生产环境基础治理能力

---

## V3.1：通知引擎基线（告警可行动）

### 目标
把“发现问题”升级为“主动触达”。

### 主要实现
- Critical 告警 Telegram 推送（默认关闭）
- 防抖间隔（默认 300 秒）
- 仅 actionable critical 才通知
- 通知状态追踪（如 `last_notified_at`）

### 文档
- `docs/v3.1-scope.md`

### 阶段结果
- 告警闭环从“看板内可见”扩展到“外部可触达”
- 在不打扰的前提下，提高故障响应速度

---

## 分享就绪改造（贯穿 V2.5 / V3.1）

### 关键动作
- 配置外置化：`.env` / `.env.local`
- 提供 `.env.example`
- Provider 默认回环地址（127.0.0.1）
- 安装脚本与示例脱敏
- 中文文档优先，英文单独分流

### 价值
- 第三方可直接复用
- 降低泄露风险
- 部署与维护成本更低

---

## 当前能力总览（截至 V3.1）

- 多节点状态总览
- Provider 健康矩阵
- 实时日志与状态流
- 告警中心 + ACK/静默
- 管理员鉴权 + 审计导出
- 数据留存与自动清理
- 健康总览
- 可选 Telegram critical 告警通知

---

## 参考文档

- V1 范围冻结：`docs/v1-scope.md`
- V2 范围：`docs/v2-scope.md`
- V3.1 范围：`docs/v3.1-scope.md`
- 中文完整安装：`docs/INSTALL_FULL_ZH.md`
- 快速部署参考：`docs/DEPLOY.md`

---

署名：**gpt 5.3 codex**
