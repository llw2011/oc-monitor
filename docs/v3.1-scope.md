# OC-Monitor V3.1 Scope（通知引擎基线）

> 目标：在 V2.5 稳定监控能力上，补齐“可行动告警通知”闭环。

---

## 1) V3.1 必做目标

1. **Critical 告警通知引擎**（默认关闭，可配置开启）
2. **Telegram 通知通道接入**
3. **通知防抖机制**（最小间隔，避免刷屏）
4. **仅 actionable critical 才触发通知**
5. **通知状态可追踪（落库字段）**

---

## 2) 非目标（V3.1 不做）

- 多通道并发（钉钉/飞书/邮件）
- 告警升级链路（L1→L2 轮值）
- On-call 排班系统
- 智能降噪/聚合 AI 判别

---

## 3) 触发规则（基线）

- 告警级别：`critical`
- 告警类型：可执行处理的 actionable 场景
- 防抖：`ALERT_NOTIFY_MIN_INTERVAL_SEC`（默认 300）
- 开关：`ALERT_NOTIFY_ENABLED=1` 时生效

---

## 4) 配置项（.env）

- `ALERT_NOTIFY_ENABLED`
- `ALERT_NOTIFY_MIN_INTERVAL_SEC`
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHAT_ID`

---

## 5) 数据追踪（建议字段）

- `last_notified_at`：最近一次通知时间
- `notify_count`：通知次数
- `last_notify_channel`：最近通知渠道（telegram）

---

## 6) 验收标准

- [x] 关闭通知时，系统不外发消息
- [x] 开启通知后，critical 告警可触发 Telegram
- [x] 连续波动场景下防抖生效
- [x] 通知状态可在系统内追踪

---

## 7) 下一阶段建议（V3.x）

- Webhook 与多通道扩展
- 告警聚合与抑制策略
- 分级通知模板（警报/恢复/升级）
- 权限系统细化（RBAC）
